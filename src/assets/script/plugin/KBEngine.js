(function(root){var exports=undefined,module=undefined,require=undefined;var define=undefined;var self=root,window=root,global=root,globalThis=root;(function(){(function(scope){"use strict";scope.KBEngine={};KBEngine.PUBLISH=0;// 发布状态
KBEngine.DEBUG=1;// 测试状态
KBEngine.is_publish=KBEngine.DEBUG;/*-----------------------------------------------------------------------------------------
													global
	-----------------------------------------------------------------------------------------*/ // http://blog.sina.com.cn/s/blog_413d250e0102wmq0.html
KBEngine.PACKET_MAX_SIZE=1500;KBEngine.PACKET_MAX_SIZE_TCP=1460;KBEngine.PACKET_MAX_SIZE_UDP=1472;KBEngine.MESSAGE_ID_LENGTH=2;KBEngine.MESSAGE_LENGTH_LENGTH=2;KBEngine.CLIENT_NO_FLOAT=0;KBEngine.KBE_FLT_MAX=3.402823466e+38;/*-----------------------------------------------------------------------------------------
													number64bits
	-----------------------------------------------------------------------------------------*/KBEngine.INT64=function(lo,hi){this.lo=lo;this.hi=hi;this.sign=1;// 2147483648二进制表示
// ‭1000 0000 0000 0000 0000 0000 0000 0000‬
// 4294967296二进制表示
// ‭0001 0000 0000 0000 0000 0000 0000 0000 0000‬
// 4294967295二进制表示
// ‭1111 1111 1111 1111 1111 1111 1111 1111‬
if(hi>=2147483648){this.sign=-1;if(this.lo>0){this.lo=4294967296-this.lo&0xffffffff;this.hi=4294967295-this.hi;}else{this.lo=4294967296-this.lo&0xffffffff;this.hi=4294967296-this.hi;}}this.toString=function(){var result="";if(this.sign<0){result+="-";}var low=this.lo.toString(16);var high=this.hi.toString(16);if(this.hi>0){result+=high;for(var i=8-low.length;i>0;--i){result+="0";}}result+=low;return result;};};KBEngine.UINT64=function(lo,hi){this.lo=lo;this.hi=hi;this.toString=function(){var low=this.lo.toString(16);var high=this.hi.toString(16);var result="";if(this.hi>0){result+=high;for(var i=8-low.length;i>0;--i){result+="0";}}result+=low;return result;};};/*-----------------------------------------------------------------------------------------
													debug
	-----------------------------------------------------------------------------------------*/KBEngine.INFO_MSG=function(s){if(KBEngine.is_publish===KBEngine.PUBLISH)return;console.info(s);};KBEngine.DEBUG_MSG=function(s){if(KBEngine.is_publish===KBEngine.PUBLISH)return;console.debug(s);};KBEngine.ERROR_MSG=function(s){if(KBEngine.is_publish===KBEngine.PUBLISH)return;console.error(s);};KBEngine.WARNING_MSG=function(s){if(KBEngine.is_publish===KBEngine.PUBLISH)return;console.warn(s);};/*-----------------------------------------------------------------------------------------
													string
	-----------------------------------------------------------------------------------------*/KBEngine.utf8ArrayToString=function(array){var out,i,len,c;var char2,char3;out="";len=array.length;i=0;while(i<len){c=array[i++];switch(c>>4){//	case 0:
case 1:case 2:case 3:case 4:case 5:case 6:case 7:// 0xxxxxxx
out+=String.fromCharCode(c);break;case 12:case 13:// 110x xxxx   10xx xxxx
char2=array[i++];out+=String.fromCharCode((c&0x1F)<<6|char2&0x3F);break;case 14:// 1110 xxxx  10xx xxxx  10xx xxxx
char2=array[i++];char3=array[i++];out+=String.fromCharCode((c&0x0F)<<12|(char2&0x3F)<<6|(char3&0x3F)<<0);break;}}return out;};KBEngine.stringToUTF8Bytes=function(str){var utf8=[];for(var i=0;i<str.length;i++){var charcode=str.charCodeAt(i);if(charcode<0x80)utf8.push(charcode);else if(charcode<0x800){utf8.push(0xc0|charcode>>6,0x80|charcode&0x3f);}else if(charcode<0xd800||charcode>=0xe000){utf8.push(0xe0|charcode>>12,0x80|charcode>>6&0x3f,0x80|charcode&0x3f);}// surrogate pair
else{i++;// UTF-16 encodes 0x10000-0x10FFFF by
// subtracting 0x10000 and splitting the
// 20 bits of 0x0-0xFFFFF into two halves
charcode=0x10000+((charcode&0x3ff)<<10|str.charCodeAt(i)&0x3ff);utf8.push(0xf0|charcode>>18,0x80|charcode>>12&0x3f,0x80|charcode>>6&0x3f,0x80|charcode&0x3f);}}return utf8;};/*-----------------------------------------------------------------------------------------
													event
	-----------------------------------------------------------------------------------------*/KBEngine.EventInfo=function(classinst,callbackfn){this.callbackfn=callbackfn;// 回调
this.classinst=classinst;// 类实例
};KBEngine.Event=function(){this._events={};this.register=function(evtName,classinst,callback){var callbackfn=callback;if(callbackfn===undefined){KBEngine.ERROR_MSG('KBEngine.Event::fire: not found callback('+classinst+")!"+callback);return;}var evtlst=this._events[evtName];if(evtlst===undefined){evtlst=[];this._events[evtName]=evtlst;}var info=new KBEngine.EventInfo(classinst,callbackfn);evtlst.push(info);};this.deregister=function(evtName,classinst){if(typeof this._events[evtName]!=="undefined"){var evtlst=this._events[evtName];for(var i=0,len=evtlst.length;i<len;i++){var info=evtlst[i];if(info.classinst===classinst){evtlst.splice(i,1);break;}}}};this.fire=function(){if(arguments.length<1){KBEngine.ERROR_MSG('KBEngine.Event::fire: not found eventName!');return;}// 事件名称
var evtName=arguments[0];// 事件列表
var evtlst=this._events[evtName];if(evtlst===undefined){return;}// 参数列表
var ars=[];var i,len;for(i=1,len=arguments.length;i<len;i++){ars.push(arguments[i]);}for(i=0,len=evtlst.length;i<len;i++){var info=evtlst[i];if(arguments.length<1){info.callbackfn.apply(info.classinst);}else{info.callbackfn.apply(info.classinst,ars);}}};};KBEngine.Event=new KBEngine.Event();/*-----------------------------------------------------------------------------------------
													memorystream
	-----------------------------------------------------------------------------------------*/KBEngine.MemoryStream=function(size_or_buffer){// KBEngine.MemoryStream.prototype.init.call(this, size_or_buffer);
this.rpos=0;this.wpos=0;this.init(size_or_buffer);};KBEngine.MemoryStream.prototype={constructor:KBEngine.MemoryStream,init:function(size_or_buffer){if(size_or_buffer instanceof ArrayBuffer){this.buffer=size_or_buffer;}else{this.buffer=new ArrayBuffer(size_or_buffer);// 创建一个二进制数据缓冲区，缓冲区大小为size_or_buffer个字节
}this.rpos=0;// 读(read)数据的时候的偏移量
this.wpos=0;// 写(write)数据的时候的偏移量
},readInt8:function(){var buf=new Int8Array(this.buffer,this.rpos,1);this.rpos+=1;return buf[0];},readInt16:function(){var v=this.readUint16();if(v>=32768){// ‭  1000 0000 0000 0000‬
v-=65536;// 1 0000 0000 0000 0000
}return v;},readInt32:function(){var v=this.readUint32();if(v>=2147483648){v-=4294967296;}return v;},readInt64:function(){return new KBEngine.INT64(this.readUint32(),this.readUint32());},readUint8:function(){var buf=new Uint8Array(this.buffer,this.rpos,1);this.rpos+=1;return buf[0];},readUint16:function(){var buf=new Uint8Array(this.buffer,this.rpos);this.rpos+=2;return((buf[1]&0xff)<<8)+(buf[0]&0xff);// 低字节在前，高字节在后
},readUint32:function(){var buf=new Uint8Array(this.buffer,this.rpos);this.rpos+=4;return(buf[3]<<24)+(buf[2]<<16)+(buf[1]<<8)+buf[0];},// readUint64: function () {
// 	var buf = new Uint32Array(this.buffer, this.rpos);
// 	this.rpos += 8;
// 	return buf[0] + buf[1] * 4294967296;
// 	//return new KBEngine.UINT64(this.readUint32(), this.readUint32());
// },
readUint64(){let littleEndian=true;var data=new DataView(this.buffer,this.rpos);var high=data.getUint32(0);var low=data.getUint32(4);if(littleEndian){low=data.getUint32(0,true);high=data.getUint32(4,true);}this.rpos+=8;return high*0x100000000+low;},readFloat:function(){var buf;try{buf=new Float32Array(this.buffer,this.rpos,1);}catch(e){buf=new Float32Array(this.buffer.slice(this.rpos,this.rpos+4));}this.rpos+=4;return buf[0];},readDouble:function(){var buf;try{buf=new Float64Array(this.buffer,this.rpos,1);}catch(e){buf=new Float64Array(this.buffer.slice(this.rpos,this.rpos+8),0,1);}this.rpos+=8;return buf[0];},//字符串是unicode，是两个字节
readString:function(length){var data=new DataView(this.buffer,this.rpos);if(length*2>data.byteLength){console.error("====readstring over buffer length");return"";}var str="";for(let i=0;i<length;i++){if(data.getUint16(i*2,true)!=0){str+=String.fromCharCode(data.getUint16(i*2,true));}else{break;}}this.rpos+=length*2;return str;},readStringUTF8:function(skip){var buf=new Uint8Array(this.buffer,this.rpos,skip);if(!!skip){this.rpos+=skip;}return KBEngine.utf8ArrayToString(buf);},/**
		 * 二进制的gbk编码转utf-8
		 * @param  {int} skip c++服务端发过来的字符串是一个数组，skip表示这个数组的长度，也对应rpos要偏移的量
		 * @return {string}      解析出来的字符串
		 */readStringGBK:function(skip){var buf=new Uint8Array(this.buffer,this.rpos);var i=0;var s="";while(true){if(buf[i]===0){i++;var arr=buf.slice(0,i);// s = new TextDecoder('gbk').decode(arr);
break;}i++;if(this.rpos+i>=this.buffer.byteLength){throw new Error("KBEngine.MemoryStream::readStringGBK: rpos("+(this.rpos+i)+") >= "+this.buffer.byteLength+" overflow!");}}this.rpos+=skip;return s;},readBlob:function(){var size=this.readUint32();var buf=new Uint8Array(this.buffer,this.rpos,size);this.rpos+=size;return buf;},readStream:function(){var buf=new Uint8Array(this.buffer,this.rpos,this.buffer.byteLength-this.rpos);this.rpos=this.buffer.byteLength;return new KBEngine.MemoryStream(buf);},writeInt8:function(v){var buf=new Int8Array(this.buffer,this.wpos,1);buf[0]=v;this.wpos+=1;},writeInt16:function(v){this.writeInt8(v&0xff);this.writeInt8(v>>8&0xff);},writeInt32:function(v){for(var i=0;i<4;i++){this.writeInt8(v>>i*8&0xff);}},writeInt64:function(v){this.writeInt32(v.lo);this.writeInt32(v.hi);},writeUint8:function(v){var buf=new Uint8Array(this.buffer,this.wpos,1);buf[0]=v;this.wpos+=1;},writeUint16:function(v){this.writeUint8(v&0xff);this.writeUint8(v>>8&0xff);},writeUint32:function(v){for(var i=0;i<4;i++)this.writeUint8(v>>i*8&0xff);},// writeUint64: function (v) {
// 	this.writeUint32(v.lo);
// 	this.writeUint32(v.hi);
// },
writeUint64(value){let littleEndian=true;var data=new DataView(this.buffer,this.wpos);var high=Math.floor(value/0x100000000);var low=value&0xffffffff;if(littleEndian){data.setUint32(0,low,true);data.setUint32(4,high,true);}else{data.setUint32(0,high);data.setUint32(4,low);}this.wpos+=8;},writeFloat:function(v){var buf;try{buf=new Float32Array(this.buffer,this.wpos,1);buf[0]=v;}catch(e){buf=new Float32Array(1);buf[0]=v;var buf1=new Uint8Array(this.buffer);var buf2=new Uint8Array(buf.buffer);buf1.set(buf2,this.wpos);}this.wpos+=4;},writeDouble:function(v){var buf;try{buf=new Float64Array(this.buffer,this.wpos,1);buf[0]=v;}catch(e){buf=new Float64Array(1);buf[0]=v;var buf1=new Uint8Array(this.buffer);var buf2=new Uint8Array(buf.buffer);buf1.set(buf2,this.wpos);}this.wpos+=8;},writeBlob:function(v){var size=v.length;if(size+4>this.space()){KBEngine.ERROR_MSG("memorystream::writeBlob: no free!");return;}this.writeUint32(size);var buf=new Uint8Array(this.buffer,this.wpos,size);if(typeof v=="string"){for(var i=0;i<size;i++){buf[i]=v.charCodeAt(i);}}else{for(var i=0;i<size;i++){buf[i]=v[i];}}this.wpos+=size;},writeString:function(v){if(v.length>this.space()){KBEngine.ERROR_MSG("memorystream::writeString: no free!");return;}var buf=new Uint8Array(this.buffer,this.wpos);var i=0;var utf8=KBEngine.stringToUTF8Bytes(v);for(var idx=0,len=utf8.length;idx<len;idx++){buf[i++]=utf8[idx];}buf[i++]=0;this.wpos+=i;},readSkip:function(v){this.rpos+=v;},// 缓冲区剩余可写字节数
space:function(){return this.buffer.byteLength-this.wpos;},length:function(){return this.wpos-this.rpos;},readEOF:function(){return this.buffer.byteLength-this.rpos<=0;},done:function(){this.rpos=this.wpos;},getbuffer:function(v){return this.buffer.slice(this.rpos,this.wpos);}};/*-----------------------------------------------------------------------------------------
													bundle
	-----------------------------------------------------------------------------------------*/KBEngine.Bundle=function(){this.stream=new KBEngine.MemoryStream(KBEngine.PACKET_MAX_SIZE_TCP);};KBEngine.Bundle.prototype={constructor:KBEngine.Bundle,newMessage:function(){},send:function(network){network.send(this.stream.getbuffer());},writeInt8:function(v){this.stream.writeInt8(v);},writeInt16:function(v){this.stream.writeInt16(v);},writeInt32:function(v){this.stream.writeInt32(v);},writeInt64:function(v){this.stream.writeInt64(v);},writeUint8:function(v){this.stream.writeUint8(v);},writeUint16:function(v){this.stream.writeUint16(v);},writeUint32:function(v){this.stream.writeUint32(v);},writeUint64:function(v){this.stream.writeUint64(v);},writeFloat:function(v){this.stream.writeFloat(v);},writeDouble:function(v){this.stream.writeDouble(v);},writeString:function(str,length){var data=new DataView(this.stream.buffer,this.stream.wpos);if(length*2>data.byteLength){console.error("====writestring over buffer length");return;}for(let i=0;i<length;i++){if(i<str.length){data.setUint16(i*2,str.charCodeAt(i),true);}else{data.setUint16(i*2,0,true);}}this.stream.wpos+=length*2;},writeBlob:function(v){this.stream.writeBlob(v);},writeUint8Array:function(v){for(var i=0,len=v.length;i<len;i++){this.writeUint8(v[i]);}}};/*-----------------------------------------------------------------------------------------
													KBEngine app
	-----------------------------------------------------------------------------------------*/KBEngine.KBEngineApp=function(){this.username=null;this.password=null;this.ip=null;this.port=null;this.onopencb=null;// 连接服务器成功后的回调
this.onclosecb=null;// 服务器断开后的回调
this.socket=null;this.stream=null;this.net=new KBEngine.Net(this);this.addr='';this.wssAddr='';};KBEngine.KBEngineApp.prototype={constructor:KBEngine.KBEngineApp,init:function(){this.net=new KBEngine.Net(this);},reset:function(){if(this.socket!==undefined&&this.socket!==null){var sock=this.socket;sock.onclose=function(){};this.socket=null;sock.close();}if(this.net!==undefined&&this.net!==null){this.net.reset();}},connect:function(cb){// console.assert(this.socket === null, "Assertion of socket not is null"); //打包微信小游戏使用console.assert会报错
if(cb!==undefined){this.onopencb=cb;}var addr;if(this.wssAddr){addr=this.wssAddr;}else{if(!!!this.ip||!!!this.port||this.ip.length===0){KBEngine.ERROR_MSG('wrong ip or port: '+this.ip+" "+this.port);return;}addr="ws://"+this.ip+":"+this.port;}KBEngine.INFO_MSG(addr);this.addr=addr;try{this.socket=new WebSocket(addr);}catch(e){KBEngine.ERROR_MSG('WebSocket init error!');KBEngine.ERROR_MSG(e);return;}var socket=this.socket;socket.binaryType="arraybuffer";// 指定收到的数据是arrayBuffer类型
socket.onopen=this.onopen.bind(this);// 指定连接成功后的回调函数
socket.onerror=this.onerror_before_onopen.bind(this);// 指定报错时的回调函数
socket.onmessage=this.onmessage.bind(this);// 指定收到服务器数据后的回调函数
socket.onclose=this.onclose.bind(this);// 指定连接关闭后的回调函数
},setOnopenCallback:function(cb){this.onopencb=cb;},setOncloseCallback:function(cb){this.onclosecb=cb;},// 网络消息统一接收处，消息从这里分发出去。
onmessage:function(msg){if(this.stream!==null){this.stream.init(msg.data);}else{this.stream=new KBEngine.MemoryStream(msg.data);}var stream=this.stream;// 读取CMD_Head头
var checkCode=stream.readUint8();//校验字段
var messageVer=stream.readUint8();//版本标识
var dataSize=stream.readUint16();//数据大小
var mainCmdID=stream.readUint16();//主命令码
var subCmdID=stream.readUint16();//子命令码
// 读取数据内容
this.net.handleMessage(mainCmdID,subCmdID,stream);},disconnect:function(){try{if(this.socket!=null){var sock=this.socket;//	sock.onclose = undefined;
this.socket=null;sock.close();KBEngine.INFO_MSG('disconnect!');}}catch(e){}},onopen:function(){KBEngine.INFO_MSG('connect success!');this.socket.onerror=this.onerror_after_onopen;this.onopencb&&this.onopencb();},onerror_before_onopen:function(evt){KBEngine.ERROR_MSG('beforeconnect error:'+evt.data);this.close();},onerror_after_onopen:function(evt){KBEngine.ERROR_MSG('afterconnect error:'+evt.data);},onclose:function(){KBEngine.INFO_MSG('connect close');this.onclosecb&&this.onclosecb();this.reset();KBEngine.Event.fire('onclose');},send:function(msg){this.socket.send(msg);},close:function(){KBEngine.INFO_MSG('close socket');this.reset();}};KBEngine.createApp=function(){return new KBEngine.KBEngineApp();};KBEngine.destroyApp=function(app){if(!app)return;app.close();};/*-----------------------------------------------------------------------------------------
											KBEngine Net
	-----------------------------------------------------------------------------------------*/KBEngine.CmdInfo=function(target,funcName,protocol){this.target=target;this.funcName=funcName;this.protocol=protocol;};KBEngine.Net=function(network){this._callClientFuncs={};this._callServerFuncs={};this._funcName2Info={};this.network=network;this.m_dwSendXorKey=0;this.m_dwRecvXorKey=0;this.m_dwSendPacketCount=0;this.m_cbSendRound=0;this.m_cbRecvRound=0;};scope.CMD_Info={"argTypes":[{'name':'cbCheckCode','type':'UINT8'},{'name':'cbMasterOrder','type':'UINT8'},{'name':'wDataSize','type':'UINT16'}],size:function(){return 4;},write2bundle:function(bundle,cbCheckCode,cbMasterOrder,wDataSize){bundle.writeUint8(cbCheckCode);bundle.writeUint8(cbMasterOrder);bundle.writeUint16(wDataSize);}};scope.CMD_Command={"argTypes":[{'name':'wMainCmdID','type':'UINT16'},{'name':'wSubCmdID','type':'UINT16'}],size:function(){return 4;},write2bundle:function(bundle,wMainCmdID,wSubCmdID){bundle.writeUint16(wMainCmdID);bundle.writeUint16(wSubCmdID);}};KBEngine.Net.prototype={constructor:KBEngine.Net,// 注册服务端和客户端的通信函数。函数参数依次是：
// target 		// 对象
// callbackName // 函数名称字符串
// protocol		// 协议
// 剩下的都是函数参数类型
registerServer:function(){var target=arguments[0];var callbackName=arguments[1];var protocol=arguments[2];var mainCmdID=protocol.mainCmdID;var subCmdID=protocol.subCmdID;var funcDic=this._callClientFuncs[mainCmdID];if(typeof funcDic==="undefined"){funcDic={};this._callClientFuncs[mainCmdID]=funcDic;}funcDic[subCmdID]=new KBEngine.CmdInfo(target,callbackName,protocol);},handleMessage:function(mainCmdID,subCmdID,stream){// KBEngine.INFO_MSG("r " + mainCmdID + " " + subCmdID);
if(!this._callClientFuncs[mainCmdID]||!this._callClientFuncs[mainCmdID][subCmdID]){KBEngine.ERROR_MSG("mainCmdID: "+mainCmdID);KBEngine.ERROR_MSG("subCmdID: "+subCmdID);KBEngine.INFO_MSG("__________________________________");return;}var funcInfo=this._callClientFuncs[mainCmdID][subCmdID];var target=funcInfo.target;var funcName=funcInfo.funcName;var protocol=funcInfo.protocol;var args=[];protocol.createFromStream(stream,args);if(args.length<=4){target[funcName].apply(target,args);}else{var data={};for(var i=0,len=protocol.argTypes.length;i<len;i++){data[protocol.argTypes[i].name]=args[i];}target[funcName].call(target,data);}},// 注册从客户端发送数据到服务端的函数
registerClient:function(){var target=arguments[0];var funcName=arguments[1];var protocol=arguments[2];var funcInfo=new KBEngine.CmdInfo(target,funcName,protocol);this._funcName2Info[funcName]=funcInfo;},/**
		 * 发送数据到服务端
		 * 第一个参数是要调用的接口名称
		 * 后面的参数是要发送的数据
		 *
		 * 根据接口名称找到对应的接口协议，这个协议里面定以了每个参数的数据类型。
		 */callServer:function(){var funcName=arguments[0];var funcInfo=this._funcName2Info[funcName];var protocol=funcInfo.protocol;var funcArgs=Array.prototype.splice.call(arguments,1);// 获得发送的参数
var bundle=new KBEngine.Bundle();bundle.newMessage();var size=CMD_Info.size()+CMD_Command.size()+protocol.size(funcArgs);// 计算待发送数据的大小。单位：字节
CMD_Info.write2bundle(bundle,0,65,size);CMD_Command.write2bundle(bundle,protocol.mainCmdID,protocol.subCmdID);protocol.write2bundle(bundle,funcArgs);bundle.send(this.network);},removeServer:function(main_cmd_id,sub_cmd_id){var func_dic=this._callClientFuncs[main_cmd_id];if(!func_dic){return;}if(func_dic[sub_cmd_id]){delete func_dic[sub_cmd_id];}},removeClient:function(main_cmd_id,sub_cmd_id){var func_dic=this._callServerFuncs[main_cmd_id];if(!func_dic){return;}if(func_dic[sub_cmd_id]){delete func_dic[sub_cmd_id];}},reset:function(){this._callClientFuncs={};this._callServerFuncs={};this._funcName2Info={};this.network=null;}};scope.MD5={/*
		 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
		 * to work around bugs in some JS interpreters.
		 */safeAdd:function(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);// 16位及以下的位相加
var msw=(x>>16)+(y>>16)+(lsw>>16);// 16位以上的位相加
return msw<<16|lsw&0xFFFF;},/*
		 * Bitwise rotate a 32-bit number to the left.
		 */bitRotateLeft:function(num,cnt){return num<<cnt|num>>>32-cnt;},/*
		 * These functions implement the four basic operations the algorithm uses.
		 */md5cmn:function(q,a,b,x,s,t){return this.safeAdd(this.bitRotateLeft(this.safeAdd(this.safeAdd(a,q),this.safeAdd(x,t)),s),b);},md5ff:function(a,b,c,d,x,s,t){return this.md5cmn(b&c|~b&d,a,b,x,s,t);},md5gg:function(a,b,c,d,x,s,t){return this.md5cmn(b&d|c&~d,a,b,x,s,t);},md5hh:function(a,b,c,d,x,s,t){return this.md5cmn(b^c^d,a,b,x,s,t);},md5ii:function(a,b,c,d,x,s,t){return this.md5cmn(c^(b|~d),a,b,x,s,t);},/*
		 * Calculate the MD5 of an array of little-endian words, and a bit length.
		 */binlMD5:function(x,len){/* append padding */x[len>>5]|=0x80<<len%32;x[(len+64>>>9<<4)+14]=len;var i;var olda;var oldb;var oldc;var oldd;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=this.md5ff(a,b,c,d,x[i],7,-680876936);d=this.md5ff(d,a,b,c,x[i+1],12,-389564586);c=this.md5ff(c,d,a,b,x[i+2],17,606105819);b=this.md5ff(b,c,d,a,x[i+3],22,-1044525330);a=this.md5ff(a,b,c,d,x[i+4],7,-176418897);d=this.md5ff(d,a,b,c,x[i+5],12,1200080426);c=this.md5ff(c,d,a,b,x[i+6],17,-1473231341);b=this.md5ff(b,c,d,a,x[i+7],22,-45705983);a=this.md5ff(a,b,c,d,x[i+8],7,1770035416);d=this.md5ff(d,a,b,c,x[i+9],12,-1958414417);c=this.md5ff(c,d,a,b,x[i+10],17,-42063);b=this.md5ff(b,c,d,a,x[i+11],22,-1990404162);a=this.md5ff(a,b,c,d,x[i+12],7,1804603682);d=this.md5ff(d,a,b,c,x[i+13],12,-40341101);c=this.md5ff(c,d,a,b,x[i+14],17,-1502002290);b=this.md5ff(b,c,d,a,x[i+15],22,1236535329);a=this.md5gg(a,b,c,d,x[i+1],5,-165796510);d=this.md5gg(d,a,b,c,x[i+6],9,-1069501632);c=this.md5gg(c,d,a,b,x[i+11],14,643717713);b=this.md5gg(b,c,d,a,x[i],20,-373897302);a=this.md5gg(a,b,c,d,x[i+5],5,-701558691);d=this.md5gg(d,a,b,c,x[i+10],9,38016083);c=this.md5gg(c,d,a,b,x[i+15],14,-660478335);b=this.md5gg(b,c,d,a,x[i+4],20,-405537848);a=this.md5gg(a,b,c,d,x[i+9],5,568446438);d=this.md5gg(d,a,b,c,x[i+14],9,-1019803690);c=this.md5gg(c,d,a,b,x[i+3],14,-187363961);b=this.md5gg(b,c,d,a,x[i+8],20,1163531501);a=this.md5gg(a,b,c,d,x[i+13],5,-1444681467);d=this.md5gg(d,a,b,c,x[i+2],9,-51403784);c=this.md5gg(c,d,a,b,x[i+7],14,1735328473);b=this.md5gg(b,c,d,a,x[i+12],20,-1926607734);a=this.md5hh(a,b,c,d,x[i+5],4,-378558);d=this.md5hh(d,a,b,c,x[i+8],11,-2022574463);c=this.md5hh(c,d,a,b,x[i+11],16,1839030562);b=this.md5hh(b,c,d,a,x[i+14],23,-35309556);a=this.md5hh(a,b,c,d,x[i+1],4,-1530992060);d=this.md5hh(d,a,b,c,x[i+4],11,1272893353);c=this.md5hh(c,d,a,b,x[i+7],16,-155497632);b=this.md5hh(b,c,d,a,x[i+10],23,-1094730640);a=this.md5hh(a,b,c,d,x[i+13],4,681279174);d=this.md5hh(d,a,b,c,x[i],11,-358537222);c=this.md5hh(c,d,a,b,x[i+3],16,-722521979);b=this.md5hh(b,c,d,a,x[i+6],23,76029189);a=this.md5hh(a,b,c,d,x[i+9],4,-640364487);d=this.md5hh(d,a,b,c,x[i+12],11,-421815835);c=this.md5hh(c,d,a,b,x[i+15],16,530742520);b=this.md5hh(b,c,d,a,x[i+2],23,-995338651);a=this.md5ii(a,b,c,d,x[i],6,-198630844);d=this.md5ii(d,a,b,c,x[i+7],10,1126891415);c=this.md5ii(c,d,a,b,x[i+14],15,-1416354905);b=this.md5ii(b,c,d,a,x[i+5],21,-57434055);a=this.md5ii(a,b,c,d,x[i+12],6,1700485571);d=this.md5ii(d,a,b,c,x[i+3],10,-1894986606);c=this.md5ii(c,d,a,b,x[i+10],15,-1051523);b=this.md5ii(b,c,d,a,x[i+1],21,-2054922799);a=this.md5ii(a,b,c,d,x[i+8],6,1873313359);d=this.md5ii(d,a,b,c,x[i+15],10,-30611744);c=this.md5ii(c,d,a,b,x[i+6],15,-1560198380);b=this.md5ii(b,c,d,a,x[i+13],21,1309151649);a=this.md5ii(a,b,c,d,x[i+4],6,-145523070);d=this.md5ii(d,a,b,c,x[i+11],10,-1120210379);c=this.md5ii(c,d,a,b,x[i+2],15,718787259);b=this.md5ii(b,c,d,a,x[i+9],21,-343485551);a=this.safeAdd(a,olda);b=this.safeAdd(b,oldb);c=this.safeAdd(c,oldc);d=this.safeAdd(d,oldd);}return[a,b,c,d];},/*
		 * Convert an array of little-endian words to a string
		 */binl2rstr:function(input){var i;var output='';var length32=input.length*32;for(i=0;i<length32;i+=8){output+=String.fromCharCode(input[i>>5]>>>i%32&0xFF);}return output;},/*
		 * Convert a raw string to an array of little-endian words
		 * Characters >255 have their high-byte silently ignored.
		 */rstr2binl:function(input){var i;var output=[];output[(input.length>>2)-1]=undefined;for(i=0;i<output.length;i+=1){output[i]=0;}var length8=input.length*8;for(i=0;i<length8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&0xFF)<<i%32;}return output;},/*
		 * Calculate the MD5 of a raw string
		 */rstrMD5:function(s){return this.binl2rstr(this.binlMD5(this.rstr2binl(s),s.length*8));},/*
		 * Calculate the HMAC-MD5, of a key and some data (raw strings)
		 */rstrHMACMD5:function(key,data){var i;var bkey=this.rstr2binl(key);var ipad=[];var opad=[];var hash;ipad[15]=opad[15]=undefined;if(bkey.length>16){bkey=this.binlMD5(bkey,key.length*8);}for(i=0;i<16;i+=1){ipad[i]=bkey[i]^0x36363636;opad[i]=bkey[i]^0x5C5C5C5C;}hash=this.binlMD5(ipad.concat(this.rstr2binl(data)),512+data.length*8);return this.binl2rstr(this.binlMD5(opad.concat(hash),512+128));},/*
		 * Convert a raw string to a hex string
		 */rstr2hex:function(input){var hexTab='0123456789abcdef';var output='';var x;var i;var len;for(i=0,len=input.length;i<len;i+=1){x=input.charCodeAt(i);output+=hexTab.charAt(x>>>4&0x0F)+hexTab.charAt(x&0x0F);}return output;},/*
		 * Encode a string as utf-8
		 */str2rstrUTF8:function(input){return unescape(encodeURIComponent(input));},/*
		 * Take string arguments and return either raw or hex encoded strings
		 */rawMD5:function(s){return this.rstrMD5(this.str2rstrUTF8(s));},hexMD5:function(s){return this.rstr2hex(this.rawMD5(s));},rawHMACMD5:function(k,d){return this.rstrHMACMD5(this.str2rstrUTF8(k),this.str2rstrUTF8(d));},hexHMACMD5:function(k,d){return this.rstr2hex(this.rawHMACMD5(k,d));},md5:function(string,key,raw){if(!key){if(!raw){return this.hexMD5(string);}return this.rawMD5(string);}if(!raw){return this.hexHMACMD5(key,string);}return this.rawHMACMD5(key,string);}};KBEngine.EncryptData=function(data){return scope.MD5.md5(data);};KBEngine.EncryptBuffer=function(buffer){};})(window);}).call(root);})(// The environment-specific global.
function(){if(typeof globalThis!=='undefined')return globalThis;if(typeof self!=='undefined')return self;if(typeof window!=='undefined')return window;if(typeof global!=='undefined')return global;if(typeof this!=='undefined')return this;return{};}.call(this));